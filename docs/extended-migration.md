# Расширенная миграция

Для упрощение взаимодействия с миграциями добавлена надстройка над базовой миграцией.
В контроллере реализован механизм автоматической подстановки опций добавления таблицы
и формирования именованных индексов по регламенту именования объектов БД.

## Настройка типа таблиц

Миграция добавляет три дополнительных преднастроенных поля:

- `charset` - Кодировка набора символов, по умолчанию `utf8`
- `encode` - Кодировка сопоставлений, по умолчанию `utf8_unicode_ci`
- `engine` - Движек базы данных по умолчанию выбрана `InnoDB`, поскольку только она
поддерживает внешние ключи.

После данной настройки создание таблиц не требует указания третьего аргумента в
функции `createTable()`, например:

```
$this->createTable('{{%table}}', [...]); // $options подставится автоматически
```

При этом параметр открыт для передачи и не будет заменен на дефолтный при его передачи.

## Автоименование индексов

Для соблюдения требований регламента в области именования индексов, в надстройке
добавлены 4 функции для автоматического именования индексов с огласно действующего регламенатб
по две функции для каждого типа индексов.

**Обычные и уникальные индексы:**

- `createIndexNamed($table, $columns, $unique = false)` - Добавление именованного индекса.
- `dropIndexNamed($table, $columns, $unique = false)` - Удаление именованного индекса.

**Внешние ключи (constraints):**

- `addForeignKeyNamed($table, $columns, $refTable, $refColumns, ...)` - Добавление именованного внешнего ключа.
- `dropForeignKeyNamed($table, $columns, $refTable, $refColumns)` - Удаление именованного внешнего ключа.

В обоих случаях упрощается создание индекса за счет отсутсвия явного указания имени
индекса, но усложняется удаление, поскольку по факту неизвестно имя индекса, что в свою
очередь и упрощает его удаление, поскольку не нужно самостоятельно дублировать имя
индекса для его создания и удаления.

Функция создания имени индекса предуматривает возможность указания названия таблицы
в фигурных скобках `{{%}}`, предворительно очищая все неразрешенные символы
из названия, т.е. удаляя все кроме сивмолов: `[a-zA-Z0-9_]`. 
